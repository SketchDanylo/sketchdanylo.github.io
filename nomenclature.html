<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Nomenclature Tool</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;user-select:none}body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#2a2a2a,#333);color:#f1f1f1;display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;transition:background .5s ease}.container{background-color:rgba(30,30,30,.95);border-radius:15px;padding:20px;max-width:900px;width:100%;box-shadow:0 8px 25px rgba(0,0,0,.4);backdrop-filter:blur(10px);position:relative;transition:transform .5s ease}h1{text-align:center;font-size:2.5rem;color:#f1f1f1;margin-bottom:20px;letter-spacing:2px;font-weight:bold;transition:color .5s ease}.toolbar{display:flex;flex-wrap:wrap;justify-content:center;margin-bottom:15px;gap:10px}.toolbar button{background-color:#444;border:none;border-radius:8px;padding:10px 15px;cursor:pointer;color:#f1f1f1;font-size:1rem;font-weight:bold;display:flex;align-items:center;justify-content:center;gap:5px;min-width:40px;transition:background-color .3s,transform .2s,box-shadow .3s,color .3s}.toolbar button:hover{background-color:#555;transform:scale(1.05);box-shadow:0 4px 8px rgba(0,0,0,.3);color:#fff}.toolbar button:active{transform:translateY(0)}.toolbar button.active{background-color:#2ecc71;box-shadow:inset 0 0 5px rgba(0,0,0,.5)}#atomCounts{text-align:center;margin-bottom:10px;font-size:1.1rem;font-weight:bold;background-color:rgba(50,50,50,.8);padding:10px;border-radius:8px;display:flex;justify-content:center;gap:15px}#canvasContainer{border:2px solid;width:800px;height:600px;position:relative;margin:0 auto 20px;border-radius:10px;background-color:#1e1e1e;box-shadow:inset 0 0 10px rgba(0,0,0,.5)}.context-menu{position:absolute;background:rgba(50,50,50,.95);color:#f1f1f1;display:none;border:1px solid #555;border-radius:10px;box-shadow:0 6px 12px rgba(0,0,0,.4);z-index:1000}.context-menu div{padding:10px 15px;cursor:pointer;font-weight:bold;display:flex;gap:5px}.context-menu div:hover{background-color:#555}.no-name{background-color:#555;border-left:4px solid #e74c3c;padding:15px;margin:10px 0;font-weight:bold;border-radius:5px;display:flex;gap:10px}.name-result{background-color:#555;border-left:4px solid #2ecc71;padding:15px;margin:10px 0;border-radius:5px;display:flex;flex-direction:column;gap:5px}@media(max-width:900px){#canvasContainer{width:100%;height:400px}h1{font-size:2rem}}@media(max-width:600px){h1{font-size:1.5rem}.toolbar button{padding:8px 10px;font-size:.9rem}#atomCounts{font-size:.9rem}#canvasContainer{height:300px}}
</style>
</head>
<body>
<div class="container">
<h1>Danylo's Nomenclature Engine</h1>
<div id="atomCounts">
<span style="color:#ebdfac;">C: 0</span> |
<span style="color:#4a9dcf;">H: 0</span> |
<span style="color:#fa5e5c;">O: 0</span> |
<span style="color:#078f00;">N: 0</span>
</div>
<div class="toolbar">
<button id="addC" title="Add Carbon" aria-label="Add Carbon"><span style="color:#ebdfac;">C</span></button>
<button id="addH" title="Add Hydrogen" aria-label="Add Hydrogen"><span style="color:#4a9dcf;">H</span></button>
<button id="bondSingle" title="Single Bond" aria-label="Single Bond"><span style="color:#f1f1f1;">-</span></button>
<button id="autoHBtn" title="Auto Fill Hydrogens" aria-label="Auto Fill Hydrogens"><span style="color:#f1f1f1;">ü™Ñ</span></button>
<button id="undoBtn" title="Undo" aria-label="Undo"><span style="color:#f1f1f1;">‚Ü©Ô∏è</span></button>
<button id="redoBtn" title="Redo" aria-label="Redo"><span style="color:#f1f1f1;">‚Ü™Ô∏è</span></button>
<button id="clearBtn" title="Clear All" aria-label="Clear All"><span style="color:#f1f1f1;">üóëÔ∏è</span></button>
<button id="namingBtn" title="Generate Name" aria-label="Generate Name"><span style="color:#f1f1f1;">üîé</span></button>
<button id="powerBtn" aria-label="i^m">i<sup>m</sup></button>
</div>
<div id="canvasContainer">
<canvas id="molCanvas" width="800" height="600"></canvas>
</div>
<div id="namingResults"></div>
</div>
<div class="context-menu" id="contextMenu">
<div id="deleteAtomItem" style="display:none;">üóëÔ∏è Delete Atom</div>
<div id="deleteBondItem" style="display:none;">üóëÔ∏è Delete Bond</div>
<div id="bondDoubleItem" style="display:none;">|| Bond</div>
<div id="bondTripleItem" style="display:none;">||| Bond</div>
<div id="cancelItem">‚ùå Cancel</div>
</div>
<script>
const canvas=document.getElementById("molCanvas");const ctx=canvas.getContext("2d");let currentTool="atom";let currentAtom="C";let currentBondType="single";let atoms=[];let bonds=[];let bondStart=-1;let isDraggingAtom=false;let dragAtomIndex=-1;const historyStack=[];const redoStack=[];const contextMenu=document.getElementById("contextMenu");const namingResults=document.getElementById("namingResults");const atomCountsDisplay=document.getElementById("atomCounts");const chainColor="#90ee90";const pinkColor="#ff69b4";let mainChainIndices=[];let highlightAtoms=new Set();const atomColors={C:"#ebdfac",H:"#4a9dcf"};const alkylPrefixes={1:{en:"meth",de:"meth"},2:{en:"eth",de:"eth"},3:{en:"prop",de:"prop"},4:{en:"but",de:"but"},5:{en:"pent",de:"pent"},6:{en:"hex",de:"hex"},7:{en:"hept",de:"hept"},8:{en:"oct",de:"oct"},9:{en:"non",de:"non"},10:{en:"dec",de:"dec"},11:{en:"undec",de:"undec"},12:{en:"dodec",de:"dodec"},13:{en:"tridec",de:"tridec"},14:{en:"tetradec",de:"tetradec"},15:{en:"pentadec",de:"pentadec"},16:{en:"hexadec",de:"hexadec"},17:{en:"heptadec",de:"heptadec"},18:{en:"octadec",de:"octadec"},19:{en:"nonadec",de:"nonadec"},20:{en:"icos",de:"icos"},21:{en:"henicos",de:"henicos"},22:{en:"docos",de:"docos"},23:{en:"tricos",de:"tricos"},24:{en:"tetracos",de:"tetracos"},25:{en:"pentacos",de:"pentacos"},26:{en:"hexacos",de:"hexacos"},27:{en:"heptacos",de:"heptacos"},28:{en:"octacos",de:"octacos"},29:{en:"nonacos",de:"nonacos"},30:{en:"triacont",de:"triacont"}};const suffixes={en:{single:"ane",double:"ene",triple:"yne"},de:{single:"an",double:"en",triple:"in"}};function pushHistory(){redoStack.length=0;const e=JSON.stringify({atoms:atoms,bonds:bonds});historyStack.push(e)}function undo(){if(historyStack.length>1){const e=historyStack.pop();redoStack.push(e);const t=historyStack[historyStack.length-1];const n=JSON.parse(t);atoms=n.atoms;bonds=n.bonds;redraw();updateAtomCounts()}}function redo(){if(redoStack.length>0){const e=redoStack.pop();historyStack.push(e);const t=JSON.parse(e);atoms=t.atoms;bonds=t.bonds;redraw();updateAtomCounts()}}function updateAtomCounts(){const e={C:0,H:0,O:0,N:0};atoms.forEach(t=>{if(e[t.atom]!==undefined)e[t.atom]++});atomCountsDisplay.innerHTML=`
<span style="color:#ebdfac;">C: ${e["C"]}</span> |
<span style="color:#4a9dcf;">H: ${e["H"]}</span> |
<span style="color:#fa5e5c;">O: ${e["O"]}</span> |
<span style="color:#078f00;">N: ${e["N"]}</span>
`}function redraw(){ctx.clearRect(0,0,canvas.width,canvas.height);bonds.forEach(e=>{const t=atoms[e.from],n=atoms[e.to];if(!t||!n)return;ctx.lineWidth=2;let a="#aaa";if(mainChainIndices.includes(e.from)&&mainChainIndices.includes(e.to))a=chainColor;ctx.strokeStyle=a;ctx.beginPath();ctx.moveTo(t.x,t.y);ctx.lineTo(n.x,n.y);ctx.stroke()});atoms.forEach((e,t)=>{let n=atomColors[e.atom]||"#fff";if(highlightAtoms.has(t))n=pinkColor;else if(mainChainIndices.includes(t)&&e.atom==="C")n=chainColor;ctx.beginPath();ctx.fillStyle=n;ctx.arc(e.x,e.y,15,0,2*Math.PI);ctx.fill();ctx.strokeStyle="#000";ctx.lineWidth=1;ctx.stroke();ctx.fillStyle="#000";ctx.font="bold 16px Poppins";const a=e.atom;const i=ctx.measureText(a).width;ctx.fillText(a,e.x-i/2,e.y+6)})}let touchTimer=null;let touchX=0;let touchY=0;canvas.addEventListener("touchstart",e=>{if(e.touches.length===1){touchX=e.touches[0].clientX-canvas.getBoundingClientRect().left;touchY=e.touches[0].clientY-canvas.getBoundingClientRect().top;touchTimer=setTimeout(()=>{const r=findAtom(touchX,touchY);const o=findBond(touchX,touchY);showContextMenu(e.touches[0].clientX,e.touches[0].clientY,r,o)},500)}});canvas.addEventListener("touchend",()=>{if(touchTimer){clearTimeout(touchTimer);touchTimer=null}});canvas.addEventListener("touchmove",()=>{if(touchTimer){clearTimeout(touchTimer);touchTimer=null}});canvas.addEventListener("contextmenu",e=>{e.preventDefault()});canvas.addEventListener("mousedown",e=>{if(e.button===2)return;const t=canvas.getBoundingClientRect();const n=e.clientX-t.left;const a=e.clientY-t.top;if(currentTool==="atom"){const i=findAtom(n,a);if(i>=0){isDraggingAtom=true;dragAtomIndex=i}else{addAtomWithNearestBond(currentAtom,n,a)}}else if(currentTool==="bond"){const i=findAtom(n,a);if(i>=0){if(bondStart<0){bondStart=i}else{if(bondStart!==i){bonds.push({from:bondStart,to:i,type:currentBondType});bondStart=-1;pushHistory();redraw();updateAtomCounts()}else{bondStart=-1}}}}});canvas.addEventListener("mousemove",e=>{if(isDraggingAtom&&dragAtomIndex>=0){const t=canvas.getBoundingClientRect();const n=e.clientX-t.left;const a=e.clientY-t.top;atoms[dragAtomIndex].x=n;atoms[dragAtomIndex].y=a;redraw()}});canvas.addEventListener("mouseup",e=>{if(isDraggingAtom&&dragAtomIndex>=0){pushHistory();redraw()}isDraggingAtom=false;dragAtomIndex=-1});function findAtom(e,t){for(let n=atoms.length-1;n>=0;n--){const a=atoms[n].x-e;const i=atoms[n].y-t;if(a*a+i*i<225)return n}return-1}function linePointDist(e,t,n,a,i,r){const o=i-e,s=r-t,c=n-e,d=a-t,l=o*c+s*d,u=c*c+d*d;const f=l/u;let v,h;if(f<0){v=e;h=t}else if(f>1){v=n;h=a}else{v=e+f*c;h=t+f*d}const g=i-v,m=r-h;return Math.sqrt(g*g+m*m)}function findBond(e,t){for(let n=0;n<bonds.length;n++){const a=bonds[n];const i=atoms[a.from],r=atoms[a.to];if(!i||!r)continue;const o=linePointDist(i.x,i.y,r.x,r.y,e,t);if(o<5)return n}return-1}function showContextMenu(e,t,n,a){hideContextMenu();contextMenu.dataset.atom=n>=0?n:"";contextMenu.dataset.bond=a>=0?a:"";if(n>=0){document.getElementById("deleteAtomItem").style.display="flex"}else if(a>=0){document.getElementById("deleteBondItem").style.display="flex";document.getElementById("bondDoubleItem").style.display="flex";document.getElementById("bondTripleItem").style.display="flex"}contextMenu.style.left=e+"px";contextMenu.style.top=t+"px";contextMenu.style.display="block"}function hideContextMenu(){contextMenu.style.display="none";document.getElementById("deleteAtomItem").style.display="none";document.getElementById("deleteBondItem").style.display="none";document.getElementById("bondDoubleItem").style.display="none";document.getElementById("bondTripleItem").style.display="none"}document.addEventListener("click",e=>{if(!contextMenu.contains(e.target)&&e.target!==contextMenu){hideContextMenu()}else{const t=parseInt(contextMenu.dataset.atom||"-1");const n=parseInt(contextMenu.dataset.bond||"-1");if(e.target.id==="deleteAtomItem"&&t>=0){deleteAtom(t);hideContextMenu()}else if(e.target.id==="deleteBondItem"&&n>=0){deleteBond(n);hideContextMenu()}else if(e.target.id==="bondDoubleItem"&&n>=0){setBondType(n,"double");hideContextMenu()}else if(e.target.id==="bondTripleItem"&&n>=0){setBondType(n,"triple");hideContextMenu()}else if(e.target.id==="cancelItem"){hideContextMenu()}}});function deleteAtom(e){bonds=bonds.filter(t=>t.from!==e&&t.to!==e);atoms.splice(e,1);bonds.forEach(t=>{if(t.from>e)t.from--;if(t.to>e)t.to--});pushHistory();redraw();updateAtomCounts()}function deleteBond(e){bonds.splice(e,1);pushHistory();redraw();updateAtomCounts()}function setBondType(e,t){if(bonds[e])bonds[e].type=t;pushHistory();redraw();updateAtomCounts()}const toolbarBtns=document.querySelectorAll(".toolbar button");toolbarBtns.forEach(e=>{e.addEventListener("click",()=>{toolbarBtns.forEach(x=>x.classList.remove("active"));e.classList.add("active");if(e.id==="addC"){currentTool="atom";currentAtom="C"}else if(e.id==="addH"){currentTool="atom";currentAtom="H"}else if(e.id==="bondSingle"){currentTool="bond";currentBondType="single"}else if(e.id==="undoBtn"){undo();return}else if(e.id==="redoBtn"){redo();return}else if(e.id==="clearBtn"){atoms=[];bonds=[];bondStart=-1;mainChainIndices=[];highlightAtoms.clear();pushHistory();redraw();updateAtomCounts();return}else if(e.id==="namingBtn"){generateName();return}else if(e.id==="powerBtn"){alert("You pressed i^m!");return}})});document.getElementById("autoHBtn").addEventListener("click",autoFillH);function addAtomWithNearestBond(e,t,n){atoms.push({atom:e,x:t,y:n});const a=atoms.length-1;if(atoms.length>1){let i=1/0;let r=-1;for(let o=0;o<atoms.length-1;o++){const s=atoms[o].x-t,c=atoms[o].y-n,d=s*s+c*c;if(d<i){i=d;r=o}}if(r>=0){bonds.push({from:r,to:a,type:"single"})}}pushHistory();updateAtomCounts();redraw()}function autoFillH(){const e={C:4,H:1};atoms.forEach((t,n)=>{if(e[t.atom]){let a=e[t.atom];let i=0;bonds.forEach(r=>{if(r.from===n||r.to===n){i+=r.type==="double"?2:r.type==="triple"?3:1}});if(t.atom==="H")i++;let r=a-i;if(t.atom!=="H"&&r>0){let o=0,s=0;while(s<r&&o<500){o++;const c=Math.random()*2*Math.PI;const d=t.x+60*Math.cos(c);const l=t.y+60*Math.sin(c);let u=false;for(let f=0;f<atoms.length;f++){const v=atoms[f].x-d,h=atoms[f].y-l;if(v*v+h*h<2025){u=true;break}}if(!u){atoms.push({atom:"H",x:d,y:l});const f=atoms.length-1;bonds.push({from:n,to:f,type:"single"});s++}}}}});pushHistory();redraw();updateAtomCounts()}function generateName(){namingResults.innerHTML="";highlightAtoms.clear();mainChainIndices=[];if(!atoms.every(e=>e.atom==="C"||e.atom==="H")){const e=document.createElement("div");e.className="no-name";e.innerText="Only C/H alkanes supported in this demo.";namingResults.appendChild(e);redraw();return}const e=findLongestChainWholeMolecule();if(e.length<1){const t=document.createElement("div");t.className="no-name";t.innerText="No carbon chain found.";namingResults.appendChild(t);redraw();return}mainChainIndices=e;const t=findSubstituents(e);const n=buildNameForLang(e,t,"en");const a=buildNameForLang(e,t,"de");const i=document.createElement("div");i.className="name-result";i.innerHTML=`
<strong>Proposed name:</strong><br/>
<span>üá¨üáß: ${n}</span><br/>
<span>üá©üá™: ${a}</span>
`;namingResults.appendChild(i);redraw()}function findLongestChainWholeMolecule(){const e=getCarbonAdj();let t=[];function n(a,i){const r=a[a.length-1],o=e.get(r)||[];let s=false;o.forEach(c=>{if(!i.has(c.partner)){i.add(c.partner);n([...a,c.partner],i);i.delete(c.partner);s=true}});if(!s&&a.length>t.length)t=a}for(let a of e.keys()){const i=new Set([a]);n([a],i)}return t}function getCarbonAdj(){const e=new Map();atoms.forEach((t,n)=>{if(t.atom==="C")e.set(n,[])});bonds.forEach(t=>{if(atoms[t.from]?.atom==="C"&&atoms[t.to]?.atom==="C"){e.get(t.from).push({partner:t.to,type:t.type});e.get(t.to).push({partner:t.from,type:t.type})}});return e}function findSubstituents(e){const t=new Set(e),n=getCarbonAdj(),a={};e.forEach((r,o)=>{a[r]=o+1});let i=[];e.forEach(r=>{const o=n.get(r)||[];o.forEach(s=>{if(!t.has(s.partner)){const c=gatherSubstituentCluster(s.partner,t,n);const d=nameSubstituentRecursively(c,r);i.push({position:a[r],subName:d.subName,subAtoms:c});d.allAtomsInSub.forEach(l=>highlightAtoms.add(l))}})});return i}function gatherSubstituentCluster(e,t,n){const a=[e];const i=new Set([e]);while(a.length){const r=a.shift();(n.get(r)||[]).forEach(o=>{if(!t.has(o.partner)&&!i.has(o.partner)){i.add(o.partner);a.push(o.partner)}})}return[...i]}function nameSubstituentRecursively(e,t){const n=buildAdjForCluster(e);const a=findLongestChainInCluster(e,n);const i=new Set(a);const r=[];a.forEach(o=>{const s=n.get(o)||[];s.forEach(c=>{if(!i.has(c.partner)){const d=gatherClusterFrom(o,c.partner,i,n);const l=nameSubstituentRecursively(d,o);const u=a.indexOf(o)+1;r.push({position:u,subName:l.subName,subAtoms:l.allAtomsInSub})}})});const o=buildSubstituentName(a.length,r);return{subName:o,allAtomsInSub:e}}function buildAdjForCluster(e){const t=new Set(e);const n=new Map();e.forEach(a=>n.set(a,[]));bonds.forEach(a=>{if(t.has(a.from)&&t.has(a.to)){n.get(a.from).push({partner:a.to});n.get(a.to).push({partner:a.from})}});return n}function findLongestChainInCluster(e,t){let n=[];function a(i,r){const o=i[i.length-1],s=t.get(o)||[];let c=false;s.forEach(d=>{if(!r.has(d.partner)){r.add(d.partner);a([...i,d.partner],r);r.delete(d.partner);c=true}});if(!c&&i.length>n.length)n=i}e.forEach(i=>{const r=new Set([i]);a([i],r)});return n}function gatherClusterFrom(e,t,n,a){const i=[t];const r=new Set([t]);while(i.length){const o=i.shift();(a.get(o)||[]).forEach(s=>{if(!n.has(s.partner)&&s.partner!==e&&!r.has(s.partner)){r.add(s.partner);i.push(s.partner)}})}return[...r]}function buildSubstituentName(e,t){const n=chainLengthPrefix(e,"en");const a=n+"yl";if(t.length<1)return a;let i=t.map(o=>({...o}));const r=e;let o=t.map(s=>({position:r+1-s.position,subName:s.subName,subAtoms:s.subAtoms}));let c=i.reduce((s,d)=>s+d.position,0);let d=o.reduce((s,d)=>s+d.position,0);let l=d<c?o:i;let u={};l.forEach(s=>{let d=s.subName;if(!u[d])u[d]=[];u[d].push(s.position)});let f=[];for(let s in u){const d=u[s].sort((g,m)=>g-m);const l=d.length;let v="";if(l===2)v="di";else if(l===3)v="tri";else if(l===4)v="tetra";let h=d.join(",");f.push(h+"-"+v+s)}f.sort();let g=f.join("-");let m=g+a;m="("+m+")";return m}function buildNameForLang(e,t,n){if(e.length<1)return"NoCarbons";let a=e.length;let i=[];t.forEach(u=>{i.push({position:u.position,name:u.subName})});if(i.length<1){let u=chainLengthPrefix(a,n);return u+suffixes[n].single}let r=i.map(u=>({...u}));let o=i.map(u=>({position:a+1-u.position,name:u.name}));let c=r.reduce((u,f)=>u+f.position,0);let d=o.reduce((u,f)=>u+f.position,0);let l=d<c?o:r;let s={};l.forEach(u=>{if(!s[u.name])s[u.name]=[];s[u.name].push(u.position)});let g=[];for(let u in s){const f=s[u].sort((v,h)=>v-h);const m=f.length;let p="";if(m===2)p="di";else if(m===3)p="tri";else if(m===4)p="tetra";else if(m===5)p="penta";else if(m===6)p="hexa";else if(m===7)p="hepta";else if(m===8)p="octa";else if(m===9)p="nona";else if(m===10)p="deca";let y=f.join(",");let w=y+"-"+p+u;g.push(w)}g.sort();let x=g.join("-");let b=chainLengthPrefix(a,n);let C=suffixes[n].single;return x+b+C}function chainLengthPrefix(e,t){const n=alkylPrefixes[e];if(!n)return"mega";return n[t]||n.en}pushHistory();redraw();updateAtomCounts();
</script>
</body>
</html>
